<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ® Juegos de EspaÃ±ol</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Fredoka+One&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --primary: #FF6B6B; --secondary: #4ECDC4; --accent: #FFE66D; --dark: #2C3E50; --success: #2ECC71; --warning: #F39C12; --danger: #E74C3C; --purple: #9B59B6; --blue: #3498DB; }
    body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: var(--dark); }
    .app-container { min-height: 100vh; padding: 20px; }
    .header { text-align: center; padding: 30px 20px; background: rgba(255,255,255,0.95); border-radius: 20px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .header h1 { font-family: 'Fredoka One', cursive; font-size: 2.5rem; color: var(--primary); text-shadow: 3px 3px 0 var(--accent); margin-bottom: 10px; }
    .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
    .game-card { background: white; border-radius: 20px; padding: 25px; cursor: pointer; transition: all 0.3s ease; border: 3px solid transparent; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    .game-card:hover { transform: translateY(-5px); border-color: var(--secondary); }
    .game-card .emoji { font-size: 3rem; margin-bottom: 15px; }
    .game-card h3 { font-family: 'Fredoka One', cursive; font-size: 1.4rem; margin-bottom: 10px; }
    .game-card p { color: #666; font-size: 0.95rem; }
    .btn { padding: 12px 30px; border: none; border-radius: 50px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; }
    .btn-primary { background: linear-gradient(135deg, var(--primary), #ff8e8e); color: white; }
    .btn-secondary { background: linear-gradient(135deg, var(--secondary), #6ee7df); color: white; }
    .btn-success { background: linear-gradient(135deg, var(--success), #58d68d); color: white; }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #f5b041); color: white; }
    .btn-danger { background: linear-gradient(135deg, var(--danger), #e57373); color: white; }
    .btn-outline { background: transparent; border: 2px solid var(--dark); color: var(--dark); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .game-screen { background: white; border-radius: 20px; padding: 30px; max-width: 900px; margin: 0 auto; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .game-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px dashed #eee; }
    .back-btn { background: #eee; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; }
    .timer { font-family: 'Fredoka One', cursive; font-size: 3rem; color: var(--primary); padding: 20px 40px; background: linear-gradient(135deg, #fff5f5, #ffe5e5); border-radius: 15px; text-align: center; }
    .timer.warning { color: var(--warning); animation: pulse 0.5s infinite; }
    .timer.danger { color: var(--danger); animation: pulse 0.3s infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .scoreboard { display: flex; gap: 20px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
    .score-card { background: linear-gradient(135deg, var(--secondary), #6ee7df); color: white; padding: 15px 30px; border-radius: 15px; text-align: center; min-width: 150px; }
    .score-card.player2 { background: linear-gradient(135deg, var(--purple), #bb8fce); }
    .score-card .label { font-size: 0.9rem; opacity: 0.9; }
    .score-card .points { font-family: 'Fredoka One', cursive; font-size: 2rem; }
    .task-card { padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; }
    .task-card.explainer { background: linear-gradient(135deg, var(--primary), #ff8e8e); color: white; }
    .task-card.guesser { background: linear-gradient(135deg, var(--purple), #bb8fce); color: white; }
    .task-card.neutral { background: linear-gradient(135deg, var(--blue), #5dade2); color: white; }
    .task-card.green { background: linear-gradient(135deg, var(--success), #58d68d); color: white; }
    .task-card.yellow { background: linear-gradient(135deg, var(--warning), #f5b041); color: white; }
    .main-word { font-family: 'Fredoka One', cursive; font-size: 3rem; margin: 20px 0; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
    .prohibited { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
    .prohibited span { background: rgba(0,0,0,0.3); padding: 8px 16px; border-radius: 10px; font-weight: 700; }
    .hint-box { background: rgba(255,255,255,0.2); padding: 15px 20px; border-radius: 10px; margin-top: 20px; }
    .role-badge { display: inline-block; padding: 10px 20px; border-radius: 30px; font-weight: 700; margin: 10px; background: rgba(255,255,255,0.3); }
    .speaking-hint { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.95rem; }
    .room-code { background: linear-gradient(135deg, var(--accent), #fff176); padding: 20px 40px; border-radius: 15px; text-align: center; margin: 20px 0; }
    .room-code .code { font-family: 'Fredoka One', cursive; font-size: 2.5rem; color: var(--dark); letter-spacing: 5px; }
    .waiting-screen { text-align: center; padding: 60px 20px; }
    .loader { width: 60px; height: 60px; border: 5px solid #eee; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 30px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .player-indicator { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: 600; }
    .player-1 { background: var(--secondary); color: white; }
    .player-2 { background: var(--purple); color: white; }
    .action-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap; }
    .progress-bar { width: 100%; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; margin: 20px 0; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--success)); transition: width 0.3s; }
    .turn-indicator { padding: 15px 25px; border-radius: 15px; text-align: center; margin: 20px 0; font-weight: 700; font-size: 1.2rem; }
    .turn-indicator.my-turn { background: linear-gradient(135deg, var(--success), #58d68d); color: white; }
    .turn-indicator.their-turn { background: linear-gradient(135deg, #eee, #ddd); color: #666; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.5s ease; }
    .admin-panel { background: linear-gradient(135deg, #1a1a2e, #16213e); color: white; min-height: 100vh; padding: 20px; }
    .admin-header { text-align: center; padding: 20px; margin-bottom: 30px; }
    .admin-header h1 { font-family: 'Fredoka One', cursive; font-size: 2rem; color: var(--accent); }
    .admin-game-view { background: rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; margin-bottom: 20px; }
    .admin-game-view h2 { color: var(--accent); margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
    .admin-players { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    .admin-player-card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; }
    .admin-player-card h3 { margin-bottom: 10px; }
    .admin-player-card .task-preview { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 10px; font-size: 0.9rem; }
    .admin-controls { display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0; justify-content: center; }
    .admin-timer { font-family: 'Fredoka One', cursive; font-size: 4rem; text-align: center; padding: 20px; color: var(--accent); }
    .admin-score-controls { display: flex; gap: 20px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
    .admin-score-box { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; min-width: 180px; }
    .admin-score-box h4 { margin-bottom: 10px; }
    .admin-score-box .score { font-family: 'Fredoka One', cursive; font-size: 3rem; margin: 10px 0; }
    .admin-score-box .btn-group { display: flex; gap: 5px; justify-content: center; }
    .admin-current-task { background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px; margin: 20px 0; }
    .admin-current-task h3 { color: var(--accent); margin-bottom: 15px; }
    .admin-task-details { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; }
    .game-list { display: grid; gap: 15px; }
    .game-list-item { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; cursor: pointer; transition: all 0.3s; }
    .game-list-item:hover { background: rgba(255,255,255,0.2); }
    .input-field { width: 100%; padding: 15px; border: 3px solid #eee; border-radius: 15px; font-size: 1.1rem; font-family: 'Nunito', sans-serif; }
    .input-field:focus { outline: none; border-color: var(--secondary); }
    @media (max-width: 768px) { .header h1 { font-size: 1.8rem; } .main-word { font-size: 2rem; } .timer { font-size: 2rem; padding: 15px 25px; } .admin-players { grid-template-columns: 1fr; } .admin-score-controls { flex-direction: column; align-items: center; } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const socket = io();

    const GAMES = [
      { id: 'tabu', emoji: 'ğŸ¤', name: 'TabÃº', desc: 'Explica la palabra sin usar las prohibidas' },
      { id: 'conjugacion', emoji: 'ğŸ“', name: 'ConjugaciÃ³n', desc: 'Pregunta y responde con el verbo correcto' },
      { id: 'palabras', emoji: 'âš¡', name: 'Palabras rÃ¡pidas', desc: 'Di palabras del tema por turnos' },
      { id: 'dialogos', emoji: 'ğŸ’¬', name: 'DiÃ¡logos', desc: 'Responde usando AHORA/ANTES/YA/QUIERO' },
      { id: 'roleplay', emoji: 'ğŸ­', name: 'Situaciones', desc: 'ActÃºa una escena de la vida real' },
      { id: 'preguntas', emoji: 'â“', name: 'Preguntas', desc: 'Responde preguntas sobre tu vida' },
      { id: 'cadena', emoji: 'ğŸ”—', name: 'Cadena', desc: 'Ãšltima letra = primera de la siguiente' },
      { id: 'adivinanza', emoji: 'ğŸ¤”', name: 'Adivina', desc: 'Describe sin decir la palabra' },
      { id: 'batalla', emoji: 'âš”ï¸', name: 'Batalla', desc: 'Di verbos del tema lo mÃ¡s rÃ¡pido posible' }
    ];

    function App() {
      const isAdminPage = window.location.pathname === '/admin' || window.location.hash === '#admin';
      const [screen, setScreen] = useState(isAdminPage ? 'admin-login' : 'entry');
      const [roomCode, setRoomCode] = useState('');
      const [inputCode, setInputCode] = useState('');
      const [playerRole, setPlayerRole] = useState(null);
      const [partnerConnected, setPartnerConnected] = useState(false);
      const [selectedGame, setSelectedGame] = useState(null);
      const [myReady, setMyReady] = useState(false);
      const [partnerReady, setPartnerReady] = useState(false);
      const [scores, setScores] = useState({ player1: 0, player2: 0 });
      const [timer, setTimer] = useState(60);
      const [currentTask, setCurrentTask] = useState(null);
      const [taskIndex, setTaskIndex] = useState(0);
      const [tasks, setTasks] = useState([]);
      const [currentTurn, setCurrentTurn] = useState('player1');
      const [isAdmin, setIsAdmin] = useState(false);

      useEffect(() => {
        socket.on('room_created', (data) => { setRoomCode(data.roomCode); setPlayerRole('player1'); setScreen('lobby'); });
        socket.on('room_joined', (data) => { setRoomCode(data.roomCode); setPlayerRole('player2'); setPartnerConnected(true); setScreen('game-select'); });
        socket.on('partner_joined', () => { setPartnerConnected(true); setScreen('game-select'); });
        socket.on('partner_disconnected', () => { setPartnerConnected(false); alert('Tu compaÃ±ero se ha desconectado'); });
        socket.on('game_selected', (data) => { setSelectedGame(GAMES.find(g => g.id === data.gameType)); setScreen('waiting'); setMyReady(false); setPartnerReady(false); });
        socket.on('player_ready_status', (data) => { if (data.player !== playerRole) setPartnerReady(data.ready); });
        socket.on('game_started', (data) => {
          setTasks(data.tasks || []); setCurrentTask(data.tasks?.[0] || null); setTaskIndex(0);
          setScreen('game'); setCurrentTurn('player1'); setScores({ player1: 0, player2: 0 }); setTimer(60);
        });
        socket.on('scores_updated', (s) => setScores(s));
        socket.on('timer_update', (t) => setTimer(t));
        socket.on('next_task', (data) => { setCurrentTask(data.task); setTaskIndex(data.index); if (data.newTurn) setCurrentTurn(data.newTurn); });
        socket.on('turn_changed', (data) => setCurrentTurn(data.turn));
        socket.on('game_finished', (data) => { setScreen('results'); if (data?.finalScores) setScores(data.finalScores); });
        socket.on('return_to_games', () => { setScreen('game-select'); setSelectedGame(null); setMyReady(false); setPartnerReady(false); });
        socket.on('error', (data) => alert(data.message));
        socket.on('admin_authenticated', (data) => { if (data.success) setIsAdmin(true); else alert('ContraseÃ±a incorrecta'); });
        return () => { socket.removeAllListeners(); };
      }, [playerRole]);

      const createRoom = () => socket.emit('create_room');
      const joinRoom = () => { if (inputCode.length >= 6) socket.emit('join_room', inputCode.toUpperCase()); };
      const selectGame = (gameType) => socket.emit('select_game', { roomCode, gameType });
      const toggleReady = () => { const r = !myReady; setMyReady(r); socket.emit('player_ready', { roomCode, ready: r }); if (r && partnerReady) socket.emit('start_game', { roomCode, gameType: selectedGame.id }); };
      const goToEntry = () => { setScreen('entry'); setRoomCode(''); setPlayerRole(null); setPartnerConnected(false); };

      if (isAdmin) return <AdminPanel socket={socket} onLogout={() => { setIsAdmin(false); setScreen('admin-login'); }} />;
      if (screen === 'admin-login') return <AdminLogin socket={socket} onBack={() => window.location.href = '/'} />;
      if (screen === 'entry') return <EntryScreen onCreate={createRoom} inputCode={inputCode} setInputCode={setInputCode} onJoin={joinRoom} />;
      if (screen === 'lobby') return <LobbyScreen roomCode={roomCode} />;
      if (screen === 'game-select') return <GameSelectScreen roomCode={roomCode} playerRole={playerRole} onSelectGame={selectGame} />;
      if (screen === 'waiting') return <WaitingToStart selectedGame={selectedGame} myReady={myReady} partnerReady={partnerReady} onToggleReady={toggleReady} onBack={() => socket.emit('return_to_games', { roomCode })} />;
      if (screen === 'game') return <GameScreen game={selectedGame} playerRole={playerRole} currentTurn={currentTurn} currentTask={currentTask} tasks={tasks} taskIndex={taskIndex} scores={scores} timer={timer} />;
      if (screen === 'results') return <ResultsScreen scores={scores} onPlayAgain={() => socket.emit('return_to_games', { roomCode })} onExit={goToEntry} />;
      return <div className="app-container"><div className="game-screen"><div className="loader"></div></div></div>;
    }

    function EntryScreen({ onCreate, inputCode, setInputCode, onJoin }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in" style={{ maxWidth: '500px' }}>
            <div style={{ textAlign: 'center' }}>
              <h1 style={{ fontFamily: 'Fredoka One', fontSize: '2.5rem', color: 'var(--primary)', marginBottom: '10px' }}>ğŸ® Â¡Juegos de EspaÃ±ol!</h1>
              <p style={{ color: '#666', marginBottom: '40px' }}>Aprende espaÃ±ol hablando con tu compaÃ±ero</p>
              <button className="btn btn-primary" onClick={onCreate} style={{ width: '100%', padding: '20px', marginBottom: '30px' }}>âœ¨ Crear sala nueva</button>
              <div style={{ borderTop: '2px dashed #eee', paddingTop: '30px' }}>
                <p style={{ marginBottom: '15px', fontWeight: '600' }}>Â¿Tienes un cÃ³digo?</p>
                <input type="text" className="input-field" placeholder="CÃ“DIGO" value={inputCode} onChange={(e) => setInputCode(e.target.value.toUpperCase())} maxLength={6} style={{ textAlign: 'center', fontSize: '1.5rem', letterSpacing: '5px', marginBottom: '15px' }} />
                <button className="btn btn-secondary" onClick={onJoin} disabled={inputCode.length < 6} style={{ width: '100%' }}>Unirse ğŸš€</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function LobbyScreen({ roomCode }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in">
            <div className="waiting-screen">
              <h2>Sala creada</h2>
              <div className="room-code"><div style={{ fontSize: '0.9rem', color: '#666' }}>Comparte este cÃ³digo:</div><div className="code">{roomCode}</div></div>
              <div className="loader"></div>
              <p>Esperando a tu compaÃ±ero...</p>
            </div>
          </div>
        </div>
      );
    }

    function GameSelectScreen({ roomCode, playerRole, onSelectGame }) {
      return (
        <div className="app-container">
          <div className="header fade-in">
            <h1>ğŸ® Â¡Elige un juego!</h1>
            <p>Sala: <strong>{roomCode}</strong> | <span className={`player-indicator ${playerRole === 'player1' ? 'player-1' : 'player-2'}`}>{playerRole === 'player1' ? 'Jugador 1' : 'Jugador 2'}</span></p>
          </div>
          <div className="games-grid">
            {GAMES.map((g, i) => (
              <div key={g.id} className="game-card fade-in" style={{ animationDelay: `${i * 0.05}s` }} onClick={() => onSelectGame(g.id)}>
                <div className="emoji">{g.emoji}</div>
                <h3>{g.name}</h3>
                <p>{g.desc}</p>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function WaitingToStart({ selectedGame, myReady, partnerReady, onToggleReady, onBack }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in">
            <button className="back-btn" onClick={onBack}>â† Volver</button>
            <div className="waiting-screen">
              <span style={{ fontSize: '4rem' }}>{selectedGame?.emoji}</span>
              <h2 style={{ marginTop: '15px' }}>{selectedGame?.name}</h2>
              <div style={{ display: 'flex', justifyContent: 'center', gap: '20px', margin: '30px 0', flexWrap: 'wrap' }}>
                <div style={{ padding: '15px 25px', borderRadius: '15px', background: myReady ? 'var(--success)' : '#eee', color: myReady ? 'white' : '#666' }}>TÃº: {myReady ? 'Â¡Listo!' : 'No listo'}</div>
                <div style={{ padding: '15px 25px', borderRadius: '15px', background: partnerReady ? 'var(--success)' : '#eee', color: partnerReady ? 'white' : '#666' }}>CompaÃ±ero: {partnerReady ? 'Â¡Listo!' : 'No listo'}</div>
              </div>
              <button className={`btn ${myReady ? 'btn-success' : 'btn-primary'}`} onClick={onToggleReady} style={{ fontSize: '1.2rem', padding: '15px 40px' }}>{myReady ? 'âœ“ Â¡Listo!' : 'Empezar'}</button>
              {myReady && !partnerReady && <p style={{ marginTop: '20px', color: '#666' }}>Esperando...</p>}
              <p style={{ marginTop: '30px', color: '#999', fontSize: '0.9rem' }}>â³ La profesora controla el tiempo y los puntos</p>
            </div>
          </div>
        </div>
      );
    }

    function GameScreen({ game, playerRole, currentTurn, currentTask, tasks, taskIndex, scores, timer }) {
      const isMyTurn = currentTurn === playerRole;
      return (
        <div className="app-container">
          <div className="game-screen fade-in">
            <div className="game-header">
              <div><span style={{ fontSize: '1.5rem' }}>{game?.emoji}</span> <strong>{game?.name}</strong></div>
              <div className={`timer ${timer <= 10 ? 'danger' : timer <= 30 ? 'warning' : ''}`}>{timer}s</div>
            </div>
            <div className="progress-bar"><div className="progress-fill" style={{ width: `${((taskIndex + 1) / Math.max(tasks.length, 1)) * 100}%` }}></div></div>
            <Scoreboard scores={scores} playerRole={playerRole} />
            <GameContent game={game} playerRole={playerRole} isMyTurn={isMyTurn} currentTask={currentTask} taskIndex={taskIndex} totalTasks={tasks.length} />
          </div>
        </div>
      );
    }

    function Scoreboard({ scores, playerRole }) {
      const other = playerRole === 'player1' ? 'player2' : 'player1';
      return (
        <div className="scoreboard">
          <div className={`score-card ${playerRole === 'player2' ? 'player2' : ''}`}><div className="label">ğŸŸ¢ TÃº</div><div className="points">{scores[playerRole] || 0}</div></div>
          <div className={`score-card ${playerRole === 'player1' ? 'player2' : ''}`}><div className="label">ğŸŸ£ CompaÃ±ero</div><div className="points">{scores[other] || 0}</div></div>
        </div>
      );
    }

    function GameContent({ game, playerRole, isMyTurn, currentTask, taskIndex, totalTasks }) {
      if (!currentTask) return <div style={{ textAlign: 'center', padding: '40px' }}><div className="loader"></div><p>Esperando tarea...</p></div>;
      switch(game?.id) {
        case 'tabu': return <TabuView task={currentTask} isMyTurn={isMyTurn} idx={taskIndex} total={totalTasks} />;
        case 'conjugacion': return <ConjugacionView task={currentTask} playerRole={playerRole} />;
        case 'palabras': return <PalabrasView task={currentTask} />;
        case 'dialogos': return <DialogosView task={currentTask} playerRole={playerRole} />;
        case 'roleplay': return <RoleplayView task={currentTask} playerRole={playerRole} />;
        case 'preguntas': return <PreguntasView task={currentTask} />;
        case 'cadena': return <CadenaView />;
        case 'adivinanza': return <AdivinanzaView task={currentTask} isMyTurn={isMyTurn} />;
        case 'batalla': return <BatallaView task={currentTask} />;
        default: return <div>Juego no encontrado</div>;
      }
    }

    function TabuView({ task, isMyTurn, idx, total }) {
      if (isMyTurn) {
        return (
          <div className="fade-in">
            <div className="turn-indicator my-turn">ğŸ¯ Â¡TE TOCA EXPLICAR!</div>
            <div className="task-card explainer">
              <p style={{ opacity: 0.9, marginBottom: '10px' }}>Palabra {idx + 1} de {total}</p>
              <div className="main-word">{task.palabra}</div>
              <p style={{ marginTop: '20px', opacity: 0.9 }}>ğŸš« NO PUEDES DECIR:</p>
              <div className="prohibited">{task.prohibidas?.map((w, i) => <span key={i}>{w}</span>)}</div>
              <div className="speaking-hint">ğŸ—£ï¸ Explica con otras palabras. Usa: "es algo que...", "sirve para...", "lo usas cuando..."</div>
            </div>
          </div>
        );
      }
      return (
        <div className="fade-in">
          <div className="turn-indicator their-turn">ğŸ‘‚ ESCUCHA Y ADIVINA</div>
          <div className="task-card guesser">
            <p style={{ fontSize: '1.5rem', marginBottom: '20px' }}>ğŸ¤”</p>
            <div className="main-word">???</div>
            <p style={{ marginTop: '20px', opacity: 0.9 }}>Tu compaÃ±ero estÃ¡ explicando una palabra...</p>
            <div className="speaking-hint">ğŸ—£ï¸ Â¡Intenta adivinar quÃ© es!</div>
          </div>
        </div>
      );
    }

    function ConjugacionView({ task, playerRole }) {
      const isAsker = playerRole === 'player1';
      if (isAsker) {
        return (
          <div className="fade-in">
            <div className="turn-indicator my-turn">ğŸ¤ LEE LA PREGUNTA</div>
            <div className="task-card neutral">
              <p style={{ opacity: 0.9 }}>Verbo: <strong>{task.verbo}</strong></p>
              <div className="main-word" style={{ fontSize: '1.8rem' }}>{task.pregunta}</div>
              <div className="hint-box">ğŸ’¡ Respuesta esperada: <strong>{task.respuesta}</strong></div>
              <div className="speaking-hint">ğŸ—£ï¸ Lee la pregunta en voz alta a tu compaÃ±ero</div>
            </div>
          </div>
        );
      }
      return (
        <div className="fade-in">
          <div className="turn-indicator their-turn">ğŸ‘‚ ESCUCHA Y RESPONDE</div>
          <div className="task-card guesser">
            <p style={{ opacity: 0.9 }}>Verbo: <strong>{task.verbo}</strong></p>
            <div className="main-word" style={{ fontSize: '1.5rem' }}>Escucha la pregunta...</div>
            <div className="speaking-hint">ğŸ—£ï¸ Responde conjugando el verbo correctamente</div>
          </div>
        </div>
      );
    }

    function PalabrasView({ task }) {
      return (
        <div className="fade-in">
          <div className="turn-indicator my-turn">âš¡ Â¡PALABRAS RÃPIDAS!</div>
          <div className="task-card green">
            <p style={{ opacity: 0.9 }}>Tema:</p>
            <div className="main-word">{task.tema}</div>
            <div className="speaking-hint">ğŸ—£ï¸ Di palabras del tema por turnos. Â¡No repitas! +1 por palabra nueva, -1 si repites</div>
          </div>
        </div>
      );
    }

    function DialogosView({ task, playerRole }) {
      const isA = playerRole === 'player1';
      return (
        <div className="fade-in">
          <div className="turn-indicator" style={{ background: 'linear-gradient(135deg, var(--purple), #bb8fce)', color: 'white' }}>ğŸ’¬ DIÃLOGO</div>
          <div className="task-card" style={{ background: 'linear-gradient(135deg, #9b59b6, #bb8fce)', color: 'white' }}>
            <p style={{ opacity: 0.9 }}>SituaciÃ³n:</p>
            <div style={{ fontSize: '1.3rem', margin: '15px 0', lineHeight: 1.5 }}>{task.situacion}</div>
            {isA ? (
              <div className="hint-box">
                <p><strong>ğŸ…°ï¸ TÃš DICES:</strong></p>
                <p style={{ fontSize: '1.2rem', margin: '10px 0' }}>"{task.fraseA}"</p>
              </div>
            ) : (
              <div className="hint-box">
                <p><strong>ğŸ…±ï¸ RESPONDE CON:</strong></p>
                <p style={{ fontSize: '2rem', margin: '10px 0' }}>{task.clave}</p>
                <p style={{ fontSize: '0.9rem', opacity: 0.8 }}>{task.claveExplicacion}</p>
              </div>
            )}
            <div className="speaking-hint">ğŸ—£ï¸ Di una frase corta. Piensa en la situaciÃ³n, no en la gramÃ¡tica.</div>
          </div>
        </div>
      );
    }

    function RoleplayView({ task, playerRole }) {
      const myRole = playerRole === 'player1' ? task.rol1 : task.rol2;
      const theirRole = playerRole === 'player1' ? task.rol2 : task.rol1;
      return (
        <div className="fade-in">
          <div className="turn-indicator" style={{ background: 'linear-gradient(135deg, var(--warning), #f5b041)', color: 'white' }}>ğŸ­ SITUACIÃ“N</div>
          <div className="task-card yellow">
            <div className="main-word" style={{ fontSize: '1.8rem' }}>ğŸ“ {task.escena}</div>
            <div style={{ display: 'flex', justifyContent: 'center', gap: '15px', margin: '20px 0', flexWrap: 'wrap' }}>
              <div className="role-badge" style={{ background: 'rgba(255,255,255,0.4)' }}>ğŸ­ TÃš: <strong>{myRole}</strong></div>
              <div className="role-badge">ğŸ­ CompaÃ±ero: <strong>{theirRole}</strong></div>
            </div>
            <p style={{ margin: '15px 0' }}>{task.instrucciones}</p>
            {task.vocabulario && <div className="hint-box">ğŸ’¡ Vocabulario: {task.vocabulario.join(' â€¢ ')}</div>}
            <div className="speaking-hint">ğŸ—£ï¸ Â¡ActÃºa la escena! Habla como en la vida real.</div>
          </div>
        </div>
      );
    }

    function PreguntasView({ task }) {
      return (
        <div className="fade-in">
          <div className="turn-indicator" style={{ background: 'linear-gradient(135deg, var(--blue), #5dade2)', color: 'white' }}>â“ PREGUNTA PERSONAL</div>
          <div className="task-card neutral">
            <div className="main-word" style={{ fontSize: '1.5rem' }}>{task.pregunta}</div>
            {task.nivel && <p style={{ opacity: 0.7, marginTop: '10px' }}>Nivel: {task.nivel}</p>}
            <div className="speaking-hint">ğŸ—£ï¸ Responde con detalle. Luego pregunta lo mismo a tu compaÃ±ero.</div>
          </div>
        </div>
      );
    }

    function CadenaView() {
      return (
        <div className="fade-in">
          <div className="turn-indicator my-turn">ğŸ”— CADENA DE PALABRAS</div>
          <div className="task-card green">
            <div className="main-word">La Ãºltima letra = la primera</div>
            <p style={{ margin: '20px 0', fontSize: '1.2rem' }}>Ejemplo: cas<strong>A</strong> â†’ <strong>A</strong>migo â†’ amig<strong>O</strong> â†’ <strong>O</strong>jo...</p>
            <div className="speaking-hint">ğŸ—£ï¸ Di palabras por turnos. Â¡No puedes repetir! +1 por palabra</div>
          </div>
        </div>
      );
    }

    function AdivinanzaView({ task, isMyTurn }) {
      if (isMyTurn) {
        return (
          <div className="fade-in">
            <div className="turn-indicator my-turn">ğŸ¯ Â¡DESCRIBE!</div>
            <div className="task-card explainer">
              <p style={{ opacity: 0.9 }}>Describe sin decir la palabra:</p>
              <div className="main-word">{task.palabra}</div>
              {task.pistas && <div className="hint-box">ğŸ’¡ Puedes usar: {task.pistas.join(', ')}</div>}
              <div className="speaking-hint">ğŸ—£ï¸ Usa: "es...", "tiene...", "estÃ¡...", "sirve para...", "normalmente..."</div>
            </div>
          </div>
        );
      }
      return (
        <div className="fade-in">
          <div className="turn-indicator their-turn">ğŸ‘‚ ESCUCHA Y ADIVINA</div>
          <div className="task-card guesser">
            <p style={{ fontSize: '1.5rem', marginBottom: '20px' }}>ğŸ¤”</p>
            <div className="main-word">???</div>
            <p style={{ marginTop: '20px', opacity: 0.9 }}>Tu compaÃ±ero describe algo...</p>
            <div className="speaking-hint">ğŸ—£ï¸ Â¡Intenta adivinar quÃ© es!</div>
          </div>
        </div>
      );
    }

    function BatallaView({ task }) {
      return (
        <div className="fade-in">
          <div className="turn-indicator" style={{ background: 'linear-gradient(135deg, var(--danger), #e57373)', color: 'white' }}>âš”ï¸ Â¡BATALLA DE VERBOS!</div>
          <div className="task-card" style={{ background: 'linear-gradient(135deg, var(--danger), #e57373)', color: 'white' }}>
            <p style={{ opacity: 0.9 }}>Tema:</p>
            <div className="main-word">{task.tema}</div>
            <div className="speaking-hint">ğŸ—£ï¸ Di verbos del tema por turnos. Â¡Lo mÃ¡s rÃ¡pido posible! +1 por verbo</div>
          </div>
        </div>
      );
    }

    function ResultsScreen({ scores, onPlayAgain, onExit }) {
      const winner = scores.player1 > scores.player2 ? 'Jugador 1' : scores.player2 > scores.player1 ? 'Jugador 2' : 'Empate';
      return (
        <div className="app-container">
          <div className="game-screen fade-in" style={{ textAlign: 'center' }}>
            <h1 style={{ fontSize: '3rem', marginBottom: '20px' }}>ğŸ‰ Â¡Fin del juego!</h1>
            <div className="scoreboard" style={{ marginBottom: '20px' }}>
              <div className="score-card" style={{ transform: scores.player1 >= scores.player2 ? 'scale(1.1)' : 'scale(1)' }}><div className="label">ğŸŸ¢ Jugador 1</div><div className="points">{scores.player1 || 0}</div></div>
              <div className="score-card player2" style={{ transform: scores.player2 > scores.player1 ? 'scale(1.1)' : 'scale(1)' }}><div className="label">ğŸŸ£ Jugador 2</div><div className="points">{scores.player2 || 0}</div></div>
            </div>
            <p style={{ fontSize: '1.5rem', marginBottom: '30px' }}>ğŸ† {winner === 'Empate' ? 'Â¡Empate!' : `Â¡Ganador: ${winner}!`}</p>
            <div className="action-buttons">
              <button className="btn btn-primary" onClick={onPlayAgain}>ğŸ® Jugar otro</button>
              <button className="btn btn-outline" onClick={onExit}>ğŸšª Salir</button>
            </div>
          </div>
        </div>
      );
    }

    function AdminLogin({ socket, onBack }) {
      const [password, setPassword] = useState('');
      return (
        <div className="app-container">
          <div className="game-screen fade-in" style={{ maxWidth: '400px' }}>
            <button className="back-btn" onClick={onBack}>â† Volver</button>
            <div style={{ textAlign: 'center', marginTop: '40px' }}>
              <h2>ğŸ‘¨â€ğŸ« Panel de Profesora</h2>
              <input type="password" className="input-field" placeholder="ContraseÃ±a" value={password} onChange={(e) => setPassword(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && socket.emit('admin_login', password)} style={{ marginTop: '30px' }} />
              <button className="btn btn-primary" onClick={() => socket.emit('admin_login', password)} style={{ marginTop: '20px' }}>Entrar</button>
            </div>
          </div>
        </div>
      );
    }

    function AdminPanel({ socket, onLogout }) {
      const [activeGames, setActiveGames] = useState([]);
      const [watchingGame, setWatchingGame] = useState(null);
      const [gameData, setGameData] = useState(null);

      useEffect(() => {
        socket.emit('admin_get_games');
        const interval = setInterval(() => socket.emit('admin_get_games'), 2000);
        socket.on('admin_games_list', (games) => setActiveGames(games));
        socket.on('admin_game_data', (data) => setGameData(data));
        return () => { clearInterval(interval); socket.off('admin_games_list'); socket.off('admin_game_data'); };
      }, []);

      useEffect(() => {
        if (watchingGame) {
          socket.emit('admin_watch_game', watchingGame);
          const interval = setInterval(() => socket.emit('admin_watch_game', watchingGame), 1000);
          return () => clearInterval(interval);
        }
      }, [watchingGame]);

      const addScore = (player, points) => { if (watchingGame) socket.emit('admin_add_score', { roomCode: watchingGame, player, points }); };
      const nextTask = () => { if (watchingGame) socket.emit('admin_next_task', { roomCode: watchingGame }); };
      const switchTurn = () => { if (watchingGame) socket.emit('admin_switch_turn', { roomCode: watchingGame }); };
      const resetTimer = (seconds) => { if (watchingGame) socket.emit('admin_reset_timer', { roomCode: watchingGame, seconds }); };
      const pauseTimer = () => { if (watchingGame) socket.emit('admin_pause_timer', { roomCode: watchingGame }); };
      const finishGame = () => { if (watchingGame) socket.emit('admin_finish_game', { roomCode: watchingGame }); };

      if (watchingGame && gameData) {
        return (
          <div className="admin-panel">
            <div className="admin-header">
              <button className="btn btn-outline" style={{ color: 'white', borderColor: 'white' }} onClick={() => { setWatchingGame(null); setGameData(null); }}>â† Volver</button>
              <h1 style={{ marginTop: '10px' }}>ğŸ® Sala: {watchingGame}</h1>
            </div>
            <div className="admin-timer" style={{ color: gameData.timer <= 10 ? 'var(--danger)' : gameData.timer <= 30 ? 'var(--warning)' : 'var(--accent)' }}>
              â±ï¸ {gameData.timer}s {gameData.timerPaused && '(PAUSADO)'}
            </div>
            <div className="admin-controls">
              <button className="btn btn-warning" onClick={pauseTimer}>{gameData.timerPaused ? 'â–¶ï¸ Reanudar' : 'â¸ï¸ Pausar'}</button>
              <button className="btn btn-secondary" onClick={() => resetTimer(60)}>ğŸ”„ 60s</button>
              <button className="btn btn-secondary" onClick={() => resetTimer(30)}>ğŸ”„ 30s</button>
              <button className="btn btn-secondary" onClick={() => resetTimer(120)}>ğŸ”„ 2min</button>
            </div>
            <div className="admin-score-controls">
              <div className="admin-score-box">
                <h4>ğŸŸ¢ Jugador 1</h4>
                <div className="score" style={{ color: 'var(--secondary)' }}>{gameData.scores?.player1 || 0}</div>
                <div className="btn-group">
                  <button className="btn btn-danger" onClick={() => addScore('player1', -1)}>-1</button>
                  <button className="btn btn-success" onClick={() => addScore('player1', 1)}>+1</button>
                  <button className="btn btn-success" onClick={() => addScore('player1', 2)}>+2</button>
                </div>
              </div>
              <div className="admin-score-box">
                <h4>ğŸŸ£ Jugador 2</h4>
                <div className="score" style={{ color: 'var(--purple)' }}>{gameData.scores?.player2 || 0}</div>
                <div className="btn-group">
                  <button className="btn btn-danger" onClick={() => addScore('player2', -1)}>-1</button>
                  <button className="btn btn-success" onClick={() => addScore('player2', 1)}>+1</button>
                  <button className="btn btn-success" onClick={() => addScore('player2', 2)}>+2</button>
                </div>
              </div>
            </div>
            <div className="admin-current-task">
              <h3>ğŸ“‹ Tarea {gameData.taskIndex + 1}/{gameData.totalTasks} â€” {gameData.currentGame?.toUpperCase()}</h3>
              <div className="admin-task-details">
                {gameData.currentTask && (
                  <div style={{ lineHeight: 1.8 }}>
                    {gameData.currentTask.palabra && <p><strong>Palabra:</strong> {gameData.currentTask.palabra}</p>}
                    {gameData.currentTask.prohibidas && <p><strong>Prohibidas:</strong> {gameData.currentTask.prohibidas.join(', ')}</p>}
                    {gameData.currentTask.verbo && <p><strong>Verbo:</strong> {gameData.currentTask.verbo}</p>}
                    {gameData.currentTask.pregunta && <p><strong>Pregunta:</strong> {gameData.currentTask.pregunta}</p>}
                    {gameData.currentTask.respuesta && <p><strong>Respuesta:</strong> {gameData.currentTask.respuesta}</p>}
                    {gameData.currentTask.tema && <p><strong>Tema:</strong> {gameData.currentTask.tema}</p>}
                    {gameData.currentTask.escena && <p><strong>Escena:</strong> {gameData.currentTask.escena}</p>}
                    {gameData.currentTask.rol1 && <p><strong>Rol 1:</strong> {gameData.currentTask.rol1} | <strong>Rol 2:</strong> {gameData.currentTask.rol2}</p>}
                    {gameData.currentTask.situacion && <p><strong>SituaciÃ³n:</strong> {gameData.currentTask.situacion}</p>}
                    {gameData.currentTask.fraseA && <p><strong>Frase A:</strong> "{gameData.currentTask.fraseA}"</p>}
                    {gameData.currentTask.clave && <p><strong>Clave B:</strong> {gameData.currentTask.clave} â€” {gameData.currentTask.claveExplicacion}</p>}
                    {gameData.currentTask.pistas && <p><strong>Pistas:</strong> {gameData.currentTask.pistas.join(', ')}</p>}
                    {gameData.currentTask.nivel && <p><strong>Nivel:</strong> {gameData.currentTask.nivel}</p>}
                  </div>
                )}
                <p style={{ marginTop: '15px', padding: '10px', background: 'rgba(255,255,255,0.1)', borderRadius: '8px' }}>
                  <strong>Turno:</strong> {gameData.currentTurn === 'player1' ? 'ğŸŸ¢ Jugador 1' : 'ğŸŸ£ Jugador 2'}
                </p>
              </div>
            </div>
            <div className="admin-controls">
              <button className="btn btn-primary" onClick={nextTask}>â¡ï¸ Siguiente tarea</button>
              <button className="btn btn-warning" onClick={switchTurn}>ğŸ”„ Cambiar turno</button>
              <button className="btn btn-danger" onClick={finishGame}>ğŸ Terminar juego</button>
            </div>
            <div className="admin-players">
              <div className="admin-player-card">
                <h3>ğŸŸ¢ Jugador 1 {gameData.currentTurn === 'player1' ? 'â† TURNO' : ''}</h3>
                <div className="task-preview">
                  {['tabu', 'adivinanza'].includes(gameData.currentGame) && gameData.currentTurn === 'player1' && (
                    <p><strong>Ve y explica:</strong> {gameData.currentTask?.palabra}</p>
                  )}
                  {['tabu', 'adivinanza'].includes(gameData.currentGame) && gameData.currentTurn !== 'player1' && (
                    <p>Ve: ??? (adivina)</p>
                  )}
                  {gameData.currentGame === 'conjugacion' && <p><strong>Lee pregunta:</strong> {gameData.currentTask?.pregunta}</p>}
                  {gameData.currentGame === 'dialogos' && <p><strong>Dice:</strong> "{gameData.currentTask?.fraseA}"</p>}
                  {gameData.currentGame === 'roleplay' && <p><strong>Rol:</strong> {gameData.currentTask?.rol1}</p>}
                  {['palabras', 'batalla', 'cadena', 'preguntas'].includes(gameData.currentGame) && <p>Participa hablando</p>}
                </div>
              </div>
              <div className="admin-player-card">
                <h3>ğŸŸ£ Jugador 2 {gameData.currentTurn === 'player2' ? 'â† TURNO' : ''}</h3>
                <div className="task-preview">
                  {['tabu', 'adivinanza'].includes(gameData.currentGame) && gameData.currentTurn === 'player2' && (
                    <p><strong>Ve y explica:</strong> {gameData.currentTask?.palabra}</p>
                  )}
                  {['tabu', 'adivinanza'].includes(gameData.currentGame) && gameData.currentTurn !== 'player2' && (
                    <p>Ve: ??? (adivina)</p>
                  )}
                  {gameData.currentGame === 'conjugacion' && <p><strong>Debe responder:</strong> {gameData.currentTask?.respuesta}</p>}
                  {gameData.currentGame === 'dialogos' && <p><strong>Responde con:</strong> {gameData.currentTask?.clave}</p>}
                  {gameData.currentGame === 'roleplay' && <p><strong>Rol:</strong> {gameData.currentTask?.rol2}</p>}
                  {['palabras', 'batalla', 'cadena', 'preguntas'].includes(gameData.currentGame) && <p>Participa hablando</p>}
                </div>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="admin-panel">
          <div className="admin-header">
            <h1>ğŸ‘¨â€ğŸ« Panel de Profesora</h1>
            <button className="btn btn-outline" style={{ color: 'white', borderColor: 'white', marginTop: '10px' }} onClick={onLogout}>Cerrar sesiÃ³n</button>
          </div>
          <div className="admin-game-view">
            <h2>ğŸ® Partidas activas ({activeGames.length})</h2>
            {activeGames.length === 0 ? (
              <p style={{ opacity: 0.7, textAlign: 'center', padding: '40px' }}>No hay partidas activas...</p>
            ) : (
              <div className="game-list">
                {activeGames.map(game => (
                  <div key={game.roomCode} className="game-list-item" onClick={() => setWatchingGame(game.roomCode)}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '10px' }}>
                      <div>
                        <h3 style={{ color: 'var(--accent)' }}>ğŸ  {game.roomCode}</h3>
                        <p>{game.currentGame ? GAMES.find(g => g.id === game.currentGame)?.name || game.currentGame : 'Eligiendo...'} | {game.playerCount}/2 jugadores</p>
                      </div>
                      <div style={{ textAlign: 'right' }}>
                        <p>ğŸŸ¢ {game.scores?.player1 || 0} vs ğŸŸ£ {game.scores?.player2 || 0}</p>
                        <p style={{ color: game.timer <= 10 ? 'var(--danger)' : 'inherit' }}>â±ï¸ {game.timer}s</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
