<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ® Juegos de EspaÃ±ol</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Fredoka+One&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #FF6B6B; --secondary: #4ECDC4; --accent: #FFE66D;
      --dark: #2C3E50; --success: #2ECC71; --warning: #F39C12;
      --danger: #E74C3C; --purple: #9B59B6; --blue: #3498DB;
    }
    body { font-family: 'Nunito', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: var(--dark); }
    .app-container { min-height: 100vh; padding: 20px; }
    .header { text-align: center; padding: 30px 20px; background: rgba(255,255,255,0.95); border-radius: 20px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .header h1 { font-family: 'Fredoka One', cursive; font-size: 2.5rem; color: var(--primary); text-shadow: 3px 3px 0 var(--accent); margin-bottom: 10px; }
    .header p { color: #666; font-size: 1.1rem; }
    .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
    .game-card { background: white; border-radius: 20px; padding: 25px; cursor: pointer; transition: all 0.3s ease; border: 3px solid transparent; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    .game-card:hover { transform: translateY(-5px); border-color: var(--secondary); box-shadow: 0 15px 40px rgba(0,0,0,0.15); }
    .game-card .emoji { font-size: 3rem; margin-bottom: 15px; }
    .game-card h3 { font-family: 'Fredoka One', cursive; font-size: 1.4rem; color: var(--dark); margin-bottom: 10px; }
    .game-card p { color: #666; font-size: 0.95rem; line-height: 1.5; }
    .btn { padding: 12px 30px; border: none; border-radius: 50px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
    .btn-primary { background: linear-gradient(135deg, var(--primary), #ff8e8e); color: white; box-shadow: 0 4px 15px rgba(255,107,107,0.4); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,107,107,0.5); }
    .btn-secondary { background: linear-gradient(135deg, var(--secondary), #6ee7df); color: white; }
    .btn-success { background: linear-gradient(135deg, var(--success), #58d68d); color: white; }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #f5b041); color: white; }
    .btn-outline { background: transparent; border: 2px solid var(--dark); color: var(--dark); }
    .btn-outline:hover { background: var(--dark); color: white; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .game-screen { background: white; border-radius: 20px; padding: 30px; max-width: 900px; margin: 0 auto; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .game-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px dashed #eee; }
    .back-btn { background: #eee; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
    .back-btn:hover { background: #ddd; }
    .timer { font-family: 'Fredoka One', cursive; font-size: 2.5rem; color: var(--primary); padding: 15px 30px; background: linear-gradient(135deg, #fff5f5, #ffe5e5); border-radius: 15px; }
    .timer.warning { color: var(--warning); animation: pulse 0.5s infinite; }
    .timer.danger { color: var(--danger); animation: pulse 0.3s infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .scoreboard { display: flex; gap: 20px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
    .score-card { background: linear-gradient(135deg, var(--secondary), #6ee7df); color: white; padding: 15px 30px; border-radius: 15px; text-align: center; min-width: 150px; }
    .score-card.player2 { background: linear-gradient(135deg, var(--purple), #bb8fce); }
    .score-card .label { font-size: 0.9rem; opacity: 0.9; }
    .score-card .points { font-family: 'Fredoka One', cursive; font-size: 2rem; }
    .tabu-card-explainer { background: linear-gradient(135deg, var(--primary), #ff8e8e); color: white; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; position: relative; overflow: hidden; }
    .tabu-card-explainer::before { content: 'ğŸ¯'; position: absolute; font-size: 150px; opacity: 0.1; right: -30px; top: -30px; }
    .tabu-card-guesser { background: linear-gradient(135deg, var(--purple), #bb8fce); color: white; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; position: relative; overflow: hidden; }
    .tabu-card-guesser::before { content: 'ğŸ¤”'; position: absolute; font-size: 150px; opacity: 0.1; right: -30px; top: -30px; }
    .tabu-word { font-family: 'Fredoka One', cursive; font-size: 3rem; margin-bottom: 30px; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
    .tabu-prohibited { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    .tabu-prohibited span { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 10px; font-weight: 700; font-size: 1.1rem; }
    .input-field { width: 100%; padding: 15px 20px; border: 3px solid #eee; border-radius: 15px; font-size: 1.1rem; font-family: 'Nunito', sans-serif; transition: all 0.3s; }
    .input-field:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 4px rgba(78,205,196,0.2); }
    .room-code { background: linear-gradient(135deg, var(--accent), #fff176); padding: 20px 40px; border-radius: 15px; text-align: center; margin: 20px 0; }
    .room-code .label { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
    .room-code .code { font-family: 'Fredoka One', cursive; font-size: 2.5rem; color: var(--dark); letter-spacing: 5px; }
    .conjugation-card { background: linear-gradient(135deg, var(--blue), #5dade2); color: white; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; }
    .conjugation-verb { font-family: 'Fredoka One', cursive; font-size: 2.5rem; margin-bottom: 20px; }
    .conjugation-question { font-size: 1.3rem; line-height: 1.6; }
    .word-chain { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0; }
    .word-chain .word { background: var(--secondary); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600; }
    .word-chain .word.player1 { background: var(--secondary); }
    .word-chain .word.player2 { background: var(--purple); }
    .roleplay-card { background: linear-gradient(135deg, var(--purple), #bb8fce); color: white; padding: 40px; border-radius: 20px; margin: 30px 0; text-align: center; }
    .roleplay-scene { font-family: 'Fredoka One', cursive; font-size: 1.8rem; margin-bottom: 20px; }
    .roleplay-roles { display: flex; gap: 20px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
    .role-badge { background: rgba(255,255,255,0.2); padding: 15px 25px; border-radius: 15px; }
    .role-badge.active { background: rgba(255,255,255,0.4); border: 2px solid white; }
    .theme-display { background: linear-gradient(135deg, var(--success), #58d68d); color: white; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; }
    .theme-name { font-family: 'Fredoka One', cursive; font-size: 2rem; margin-bottom: 10px; }
    .words-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
    .word-tag { background: rgba(255,255,255,0.3); padding: 8px 16px; border-radius: 20px; font-weight: 600; }
    .question-card { background: linear-gradient(135deg, var(--warning), #f5b041); color: white; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; }
    .question-text { font-size: 1.5rem; line-height: 1.6; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.5s ease; }
    .waiting-screen { text-align: center; padding: 60px 20px; }
    .waiting-screen .loader { width: 60px; height: 60px; border: 5px solid #eee; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 30px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .chat-messages { background: #f5f5f5; border-radius: 15px; padding: 20px; max-height: 300px; overflow-y: auto; margin: 20px 0; }
    .chat-message { margin-bottom: 15px; padding: 10px 15px; border-radius: 10px; max-width: 80%; }
    .chat-message.player1 { background: var(--secondary); color: white; margin-right: auto; }
    .chat-message.player2 { background: var(--purple); color: white; margin-left: auto; }
    .player-indicator { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; }
    .player-1 { background: var(--secondary); color: white; }
    .player-2 { background: var(--purple); color: white; }
    .action-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap; }
    .progress-bar { width: 100%; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin: 20px 0; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--secondary), var(--success)); transition: width 0.3s ease; }
    .turn-indicator { background: linear-gradient(135deg, var(--accent), #fff176); padding: 15px 25px; border-radius: 15px; text-align: center; margin: 20px 0; font-weight: 700; }
    .turn-indicator.my-turn { background: linear-gradient(135deg, var(--success), #58d68d); color: white; }
    .battle-arena { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    .battle-player { background: linear-gradient(135deg, var(--secondary), #6ee7df); padding: 20px; border-radius: 15px; color: white; }
    .battle-player.player-two { background: linear-gradient(135deg, var(--purple), #bb8fce); }
    .battle-player h4 { margin-bottom: 10px; }
    .battle-words { min-height: 150px; font-size: 0.9rem; }
    .admin-panel { background: linear-gradient(135deg, #2c3e50, #3d566e); color: white; min-height: 100vh; padding: 20px; }
    .admin-header { text-align: center; padding: 20px; margin-bottom: 30px; }
    .admin-header h1 { font-family: 'Fredoka One', cursive; font-size: 2rem; }
    .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .admin-tab { padding: 10px 20px; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; color: white; cursor: pointer; font-weight: 600; }
    .admin-tab.active { background: var(--secondary); }
    .admin-card { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
    .admin-card h3 { margin-bottom: 15px; color: var(--accent); }
    .task-list { max-height: 400px; overflow-y: auto; }
    .task-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .task-item .task-content { flex: 1; }
    .task-item .task-word { font-weight: 700; font-size: 1.1rem; color: var(--accent); }
    .task-item .task-prohibited { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
    .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid rgba(255,255,255,0.2); border-radius: 10px; background: rgba(255,255,255,0.1); color: white; font-size: 1rem; }
    .delete-btn { background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .modal { background: white; border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
    .modal h2 { margin-bottom: 20px; color: var(--dark); }
    .modal .form-group input, .modal .form-group textarea, .modal .form-group select { background: #f5f5f5; color: var(--dark); border-color: #ddd; }
    @media (max-width: 768px) { .header h1 { font-size: 1.8rem; } .tabu-word { font-size: 2rem; } .timer { font-size: 2rem; } .scoreboard { flex-direction: column; align-items: center; } .battle-arena { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const socket = io();

    const GAMES = [
      { id: 'tabu', emoji: 'ğŸ¤', name: 'TabÃº', description: 'Explica la palabra sin usar las palabras prohibidas.' },
      { id: 'conjugacion', emoji: 'ğŸ“', name: 'ConjugaciÃ³n', description: 'Uno hace la pregunta, el otro responde conjugando.' },
      { id: 'palabras', emoji: 'âš¡', name: 'Palabras rÃ¡pidas', description: '30 segundos para decir todas las palabras que puedas.' },
      { id: 'dialogos', emoji: 'ğŸ’¬', name: 'DiÃ¡logos', description: 'Practica tiempos verbales en conversaciÃ³n.' },
      { id: 'roleplay', emoji: 'ğŸ­', name: 'Situaciones', description: 'Escenas de la vida real: cafÃ©, tienda, calle...' },
      { id: 'preguntas', emoji: 'â“', name: 'Preguntas personales', description: 'Preguntas sobre tu vida. Responde y pregunta.' },
      { id: 'cadena', emoji: 'ğŸ”—', name: 'Cadena de palabras', description: 'La Ãºltima letra = la primera de la siguiente.' },
      { id: 'adivinanza', emoji: 'ğŸ¤”', name: 'Adivina quÃ© es', description: 'Describe algo sin decir su nombre.' },
      { id: 'batalla', emoji: 'âš”ï¸', name: 'Batalla de verbos', description: '60 segundos: Â¿QuiÃ©n conjuga mÃ¡s verbos?' }
    ];

    function App() {
      const isAdminPage = window.location.pathname === '/admin' || window.location.hash === '#admin';
      const [screen, setScreen] = useState('entry');
      const [roomCode, setRoomCode] = useState('');
      const [inputCode, setInputCode] = useState('');
      const [playerRole, setPlayerRole] = useState(null);
      const [partnerConnected, setPartnerConnected] = useState(false);
      const [selectedGame, setSelectedGame] = useState(null);
      const [myReady, setMyReady] = useState(false);
      const [partnerReady, setPartnerReady] = useState(false);
      const [scores, setScores] = useState({ player1: 0, player2: 0 });
      const [timer, setTimer] = useState(30);
      const [timerActive, setTimerActive] = useState(false);
      const [currentTask, setCurrentTask] = useState(null);
      const [taskIndex, setTaskIndex] = useState(0);
      const [tasks, setTasks] = useState([]);
      const [history, setHistory] = useState([]);
      const [wordsSubmitted, setWordsSubmitted] = useState([]);
      const [currentTurn, setCurrentTurn] = useState('player1');
      const [isAdmin, setIsAdmin] = useState(false);

      useEffect(() => { if (isAdminPage) setScreen('admin-login'); }, []);

      useEffect(() => {
        socket.on('room_created', (data) => { setRoomCode(data.roomCode); setPlayerRole('player1'); setScreen('lobby'); });
        socket.on('room_joined', (data) => { setRoomCode(data.roomCode); setPlayerRole('player2'); setPartnerConnected(true); setScreen('game-select'); });
        socket.on('partner_joined', () => { setPartnerConnected(true); setScreen('game-select'); });
        socket.on('partner_disconnected', () => { setPartnerConnected(false); alert('Tu compaÃ±ero se ha desconectado'); setScreen('game-select'); });
        socket.on('game_selected', (data) => { setSelectedGame(GAMES.find(g => g.id === data.gameType)); setScreen('waiting'); setMyReady(false); setPartnerReady(false); });
        socket.on('player_ready_status', (data) => { if (data.player !== playerRole) setPartnerReady(data.ready); });
        socket.on('game_started', (data) => {
          setTasks(data.tasks || []); setCurrentTask(data.tasks?.[0] || null); setTaskIndex(0);
          setScreen('game'); setCurrentTurn(data.startingPlayer || 'player1');
          setScores({ player1: 0, player2: 0 }); setHistory([]); setWordsSubmitted([]);
          if (data.hasTimer) { setTimer(data.timerDuration || 30); setTimerActive(true); }
        });
        socket.on('scores_updated', (s) => setScores(s));
        socket.on('timer_update', (t) => setTimer(t));
        socket.on('timer_finished', () => setTimerActive(false));
        socket.on('next_task', (data) => { setCurrentTask(data.task); setTaskIndex(data.index); if (data.switchTurn) setCurrentTurn(prev => prev === 'player1' ? 'player2' : 'player1'); });
        socket.on('turn_changed', (data) => setCurrentTurn(data.turn));
        socket.on('answer_submitted', (data) => setHistory(prev => [...prev, data]));
        socket.on('word_added', (data) => setWordsSubmitted(prev => [...prev, { word: data.word, player: data.player }]));
        socket.on('game_finished', () => { setScreen('results'); setTimerActive(false); });
        socket.on('return_to_games', () => { setScreen('game-select'); setSelectedGame(null); setMyReady(false); setPartnerReady(false); setCurrentTask(null); setTasks([]); setHistory([]); setWordsSubmitted([]); });
        socket.on('error', (data) => alert(data.message));
        socket.on('admin_authenticated', (data) => { if (data.success) setIsAdmin(true); else alert('ContraseÃ±a incorrecta'); });
        return () => { socket.off('room_created'); socket.off('room_joined'); socket.off('partner_joined'); socket.off('partner_disconnected'); socket.off('game_selected'); socket.off('player_ready_status'); socket.off('game_started'); socket.off('scores_updated'); socket.off('timer_update'); socket.off('timer_finished'); socket.off('next_task'); socket.off('turn_changed'); socket.off('answer_submitted'); socket.off('word_added'); socket.off('game_finished'); socket.off('return_to_games'); socket.off('error'); socket.off('admin_authenticated'); };
      }, [playerRole]);

      const createRoom = () => socket.emit('create_room');
      const joinRoom = () => { if (inputCode.length >= 6) socket.emit('join_room', inputCode.toUpperCase()); };
      const selectGame = (gameType) => socket.emit('select_game', { roomCode, gameType });
      const toggleReady = () => { const r = !myReady; setMyReady(r); socket.emit('player_ready', { roomCode, ready: r }); if (r && partnerReady) socket.emit('start_game', { roomCode, gameType: selectedGame.id }); };
      const submitAnswer = (action, value) => socket.emit('submit_answer', { roomCode, action, value, player: playerRole });
      const updateScore = (player, points) => socket.emit('update_score', { roomCode, player, points });
      const nextTask = (switchTurn = false) => socket.emit('next_task', { roomCode, switchTurn });
      const addWord = (word) => socket.emit('add_word', { roomCode, word, player: playerRole });
      const finishGame = () => socket.emit('finish_game', { roomCode });
      const returnToGames = () => socket.emit('return_to_games', { roomCode });
      const goToEntry = () => { setScreen('entry'); setRoomCode(''); setInputCode(''); setPlayerRole(null); setPartnerConnected(false); };

      if (isAdmin) return <AdminPanel socket={socket} onLogout={() => { setIsAdmin(false); setScreen('admin-login'); }} />;
      if (screen === 'admin-login') return <AdminLogin socket={socket} onBack={() => window.location.href = '/'} />;
      if (screen === 'entry') return <EntryScreen onCreate={createRoom} inputCode={inputCode} setInputCode={setInputCode} onJoin={joinRoom} />;
      if (screen === 'lobby') return <LobbyScreen roomCode={roomCode} />;
      if (screen === 'game-select') return <GameSelectScreen roomCode={roomCode} playerRole={playerRole} onSelectGame={selectGame} />;
      if (screen === 'waiting') return <WaitingToStart selectedGame={selectedGame} playerRole={playerRole} myReady={myReady} partnerReady={partnerReady} onToggleReady={toggleReady} onBack={() => socket.emit('return_to_games', { roomCode })} />;
      if (screen === 'game') return <GameScreen game={selectedGame} playerRole={playerRole} currentTurn={currentTurn} currentTask={currentTask} tasks={tasks} taskIndex={taskIndex} scores={scores} timer={timer} timerActive={timerActive} history={history} wordsSubmitted={wordsSubmitted} onSubmit={submitAnswer} onScore={updateScore} onNext={nextTask} onAddWord={addWord} onFinish={finishGame} onBack={returnToGames} />;
      if (screen === 'results') return <ResultsScreen scores={scores} onPlayAgain={returnToGames} onExit={goToEntry} />;
      return <div>Cargando...</div>;
    }

    function EntryScreen({ onCreate, inputCode, setInputCode, onJoin }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in" style={{ maxWidth: '500px' }}>
            <div style={{ textAlign: 'center' }}>
              <h1 style={{ fontFamily: 'Fredoka One', fontSize: '2.5rem', color: 'var(--primary)', marginBottom: '10px' }}>ğŸ® Â¡Juegos de EspaÃ±ol!</h1>
              <p style={{ color: '#666', marginBottom: '40px' }}>Aprende espaÃ±ol jugando con tu compaÃ±ero</p>
              <div style={{ marginBottom: '40px' }}>
                <button className="btn btn-primary" onClick={onCreate} style={{ width: '100%', padding: '20px' }}>âœ¨ Crear sala nueva</button>
              </div>
              <div style={{ borderTop: '2px dashed #eee', paddingTop: '30px' }}>
                <p style={{ marginBottom: '15px', fontWeight: '600' }}>Â¿Tienes un cÃ³digo?</p>
                <input type="text" className="input-field" placeholder="CÃ³digo de 6 letras" value={inputCode} onChange={(e) => setInputCode(e.target.value.toUpperCase())} maxLength={6} style={{ textAlign: 'center', fontSize: '1.5rem', letterSpacing: '5px', marginBottom: '15px' }} />
                <button className="btn btn-secondary" onClick={onJoin} disabled={inputCode.length < 6} style={{ width: '100%' }}>Unirse ğŸš€</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function LobbyScreen({ roomCode }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in">
            <div className="waiting-screen">
              <h2 style={{ marginBottom: '20px' }}>Sala creada</h2>
              <div className="room-code"><div className="label">Comparte este cÃ³digo:</div><div className="code">{roomCode}</div></div>
              <div className="loader"></div>
              <p>Esperando a tu compaÃ±ero...</p>
            </div>
          </div>
        </div>
      );
    }

    function GameSelectScreen({ roomCode, playerRole, onSelectGame }) {
      return (
        <div className="app-container">
          <div className="header fade-in">
            <h1>ğŸ® Â¡Elige un juego!</h1>
            <p>Sala: <strong>{roomCode}</strong> | Eres: <span className={`player-indicator ${playerRole === 'player1' ? 'player-1' : 'player-2'}`}>{playerRole === 'player1' ? 'Jugador 1' : 'Jugador 2'}</span></p>
          </div>
          <div className="games-grid">
            {GAMES.map((game, i) => (
              <div key={game.id} className="game-card fade-in" style={{ animationDelay: `${i * 0.05}s` }} onClick={() => onSelectGame(game.id)}>
                <div className="emoji">{game.emoji}</div>
                <h3>{game.name}</h3>
                <p>{game.description}</p>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function WaitingToStart({ selectedGame, playerRole, myReady, partnerReady, onToggleReady, onBack }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in">
            <button className="back-btn" onClick={onBack}>â† Volver</button>
            <div className="waiting-screen">
              <div style={{ marginBottom: '30px' }}><span style={{ fontSize: '4rem' }}>{selectedGame?.emoji}</span><h2 style={{ marginTop: '15px' }}>{selectedGame?.name}</h2></div>
              <div style={{ display: 'flex', justifyContent: 'center', gap: '20px', marginBottom: '30px', flexWrap: 'wrap' }}>
                <div style={{ padding: '15px 25px', borderRadius: '15px', background: myReady ? 'var(--success)' : '#eee', color: myReady ? 'white' : '#666' }}>{playerRole === 'player1' ? 'ğŸŸ¢' : 'ğŸŸ£'} TÃº: {myReady ? 'Â¡Listo!' : 'No listo'}</div>
                <div style={{ padding: '15px 25px', borderRadius: '15px', background: partnerReady ? 'var(--success)' : '#eee', color: partnerReady ? 'white' : '#666' }}>CompaÃ±ero: {partnerReady ? 'Â¡Listo!' : 'No listo'}</div>
              </div>
              <button className={`btn ${myReady ? 'btn-success' : 'btn-primary'}`} onClick={onToggleReady} style={{ fontSize: '1.2rem', padding: '15px 40px' }}>{myReady ? 'âœ“ Â¡Estoy listo!' : 'Empezar'}</button>
              {myReady && !partnerReady && <p style={{ marginTop: '20px', color: '#666' }}>Esperando a tu compaÃ±ero...</p>}
            </div>
          </div>
        </div>
      );
    }

    function GameScreen({ game, playerRole, currentTurn, currentTask, tasks, taskIndex, scores, timer, timerActive, history, wordsSubmitted, onSubmit, onScore, onNext, onAddWord, onFinish, onBack }) {
      return (
        <div className="app-container">
          <div className="game-screen fade-in">
            <div className="game-header">
              <button className="back-btn" onClick={onBack}>â† Salir</button>
              <div style={{ textAlign: 'center' }}><span style={{ fontSize: '1.5rem' }}>{game?.emoji}</span><span style={{ marginLeft: '10px', fontWeight: '700' }}>{game?.name}</span></div>
              {timerActive ? <div className={`timer ${timer <= 10 ? 'danger' : timer <= 20 ? 'warning' : ''}`}>{timer}s</div> : <div style={{ width: '100px' }}></div>}
            </div>
            <Scoreboard scores={scores} playerRole={playerRole} />
            <GameContent game={game} playerRole={playerRole} isMyTurn={currentTurn === playerRole} currentTask={currentTask} tasks={tasks} taskIndex={taskIndex} history={history} wordsSubmitted={wordsSubmitted} onSubmit={onSubmit} onScore={onScore} onNext={onNext} onAddWord={onAddWord} onFinish={onFinish} />
          </div>
        </div>
      );
    }

    function Scoreboard({ scores, playerRole }) {
      const other = playerRole === 'player1' ? 'player2' : 'player1';
      return (
        <div className="scoreboard">
          <div className={`score-card ${playerRole === 'player2' ? 'player2' : ''}`}><div className="label">{playerRole === 'player1' ? 'ğŸŸ¢' : 'ğŸŸ£'} TÃº</div><div className="points">{scores[playerRole] || 0}</div></div>
          <div className={`score-card ${playerRole === 'player1' ? 'player2' : ''}`}><div className="label">{playerRole === 'player1' ? 'ğŸŸ£' : 'ğŸŸ¢'} CompaÃ±ero</div><div className="points">{scores[other] || 0}</div></div>
        </div>
      );
    }

    function GameContent({ game, playerRole, isMyTurn, currentTask, tasks, taskIndex, history, wordsSubmitted, onSubmit, onScore, onNext, onAddWord, onFinish }) {
      switch(game?.id) {
        case 'tabu': return <TabuGame task={currentTask} playerRole={playerRole} isMyTurn={isMyTurn} taskIndex={taskIndex} totalTasks={tasks.length} onScore={onScore} onNext={onNext} onFinish={onFinish} />;
        case 'conjugacion': return <ConjugacionGame task={currentTask} playerRole={playerRole} isMyTurn={isMyTurn} onSubmit={onSubmit} onNext={onNext} history={history} />;
        case 'palabras': return <PalabrasGame task={currentTask} wordsSubmitted={wordsSubmitted} playerRole={playerRole} onAddWord={onAddWord} onFinish={onFinish} />;
        case 'dialogos': return <DialogosGame task={currentTask} playerRole={playerRole} onSubmit={onSubmit} onNext={onNext} history={history} />;
        case 'roleplay': return <RoleplayGame task={currentTask} playerRole={playerRole} onNext={onNext} />;
        case 'preguntas': return <PreguntasGame task={currentTask} playerRole={playerRole} onSubmit={onSubmit} onNext={onNext} history={history} />;
        case 'cadena': return <CadenaGame wordsSubmitted={wordsSubmitted} playerRole={playerRole} onAddWord={onAddWord} onFinish={onFinish} />;
        case 'adivinanza': return <AdivinanzaGame task={currentTask} playerRole={playerRole} isMyTurn={isMyTurn} onScore={onScore} onNext={onNext} />;
        case 'batalla': return <BatallaGame playerRole={playerRole} history={history} onSubmit={onSubmit} onScore={onScore} onFinish={onFinish} />;
        default: return <div style={{ textAlign: 'center', padding: '40px' }}>Juego no encontrado</div>;
      }
    }

    function TabuGame({ task, playerRole, isMyTurn, taskIndex, totalTasks, onScore, onNext, onFinish }) {
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const handleCorrect = () => { onScore(isMyTurn ? playerRole : (playerRole === 'player1' ? 'player2' : 'player1'), 1); if (taskIndex + 1 >= totalTasks) onFinish(); else onNext(true); };
      const handleSkip = () => { if (taskIndex + 1 >= totalTasks) onFinish(); else onNext(true); };
      if (isMyTurn) {
        return (
          <div className="fade-in">
            <div className="progress-bar"><div className="progress-fill" style={{ width: `${((taskIndex + 1) / totalTasks) * 100}%` }}></div></div>
            <p style={{ textAlign: 'center', color: '#666', marginBottom: '10px' }}>Palabra {taskIndex + 1} de {totalTasks}</p>
            <div className="turn-indicator my-turn">ğŸ¯ Â¡Te toca explicar!</div>
            <div className="tabu-card-explainer">
              <p style={{ marginBottom: '10px', opacity: '0.9' }}>Explica esta palabra:</p>
              <div className="tabu-word">{task.palabra}</div>
              <p style={{ marginBottom: '15px', opacity: '0.9' }}>ğŸš« NO puedes decir:</p>
              <div className="tabu-prohibited">{task.prohibidas?.map((w, i) => <span key={i}>{w}</span>)}</div>
            </div>
            <div className="action-buttons">
              <button className="btn btn-success" onClick={handleCorrect}>âœ“ Â¡AdivinÃ³!</button>
              <button className="btn btn-warning" onClick={handleSkip}>â†’ Pasar</button>
            </div>
          </div>
        );
      }
      return (
        <div className="fade-in">
          <div className="progress-bar"><div className="progress-fill" style={{ width: `${((taskIndex + 1) / totalTasks) * 100}%` }}></div></div>
          <p style={{ textAlign: 'center', color: '#666', marginBottom: '10px' }}>Palabra {taskIndex + 1} de {totalTasks}</p>
          <div className="turn-indicator">ğŸ‘‚ Turno de tu compaÃ±ero</div>
          <div className="tabu-card-guesser">
            <p style={{ fontSize: '1.5rem', marginBottom: '20px' }}>ğŸ¤” Escucha y adivina</p>
            <p style={{ fontSize: '1.2rem', opacity: '0.9' }}>Tu compaÃ±ero estÃ¡ explicando...</p>
            <p style={{ marginTop: '30px', fontSize: '3rem' }}>â“</p>
          </div>
          <p style={{ textAlign: 'center', color: '#666' }}>Cuando adivines, tu compaÃ±ero marcarÃ¡ si es correcto</p>
        </div>
      );
    }

    function ConjugacionGame({ task, playerRole, isMyTurn, onSubmit, onNext, history }) {
      const [answer, setAnswer] = useState('');
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const handleSubmit = () => { if (answer.trim()) { onSubmit('answer', answer); setAnswer(''); } };
      const isAsking = (playerRole === 'player1' && isMyTurn) || (playerRole === 'player2' && !isMyTurn);
      return (
        <div className="fade-in">
          <div className="conjugation-card">
            <p style={{ marginBottom: '10px', opacity: '0.9' }}>Verbo: <strong>({task.verbo})</strong></p>
            <div className="conjugation-question">{task.pregunta}</div>
          </div>
          {isAsking ? (
            <div style={{ textAlign: 'center' }}>
              <div className="turn-indicator my-turn">ğŸ¤ Lee la pregunta en voz alta</div>
              <div style={{ background: '#f5f5f5', padding: '15px', borderRadius: '10px', marginTop: '20px' }}>
                <p style={{ fontSize: '0.9rem', color: '#666' }}>ğŸ’¡ Respuesta esperada:</p>
                <p style={{ fontWeight: '600' }}>{task.respuesta}</p>
              </div>
              <div className="action-buttons"><button className="btn btn-secondary" onClick={() => onNext(true)}>â†’ Siguiente</button></div>
            </div>
          ) : (
            <div>
              <div className="turn-indicator">ğŸ‘‚ Escucha y responde</div>
              <div style={{ marginTop: '20px' }}>
                <input type="text" className="input-field" placeholder="Escribe tu respuesta..." value={answer} onChange={(e) => setAnswer(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSubmit()} />
                <div className="action-buttons"><button className="btn btn-primary" onClick={handleSubmit}>Enviar</button></div>
              </div>
            </div>
          )}
        </div>
      );
    }

    function PalabrasGame({ task, wordsSubmitted, playerRole, onAddWord, onFinish }) {
      const [input, setInput] = useState('');
      const inputRef = useRef(null);
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const handleAdd = (e) => { e.preventDefault(); if (input.trim()) { onAddWord(input.trim()); setInput(''); inputRef.current?.focus(); } };
      const myWords = wordsSubmitted.filter(w => w.player === playerRole);
      const theirWords = wordsSubmitted.filter(w => w.player !== playerRole);
      return (
        <div className="fade-in">
          <div className="theme-display"><p style={{ marginBottom: '10px', opacity: '0.9' }}>Tema:</p><div className="theme-name">{task.tema}</div></div>
          <form onSubmit={handleAdd} style={{ marginTop: '20px' }}><input ref={inputRef} type="text" className="input-field" placeholder="Escribe una palabra y pulsa Enter..." value={input} onChange={(e) => setInput(e.target.value)} autoFocus /></form>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginTop: '20px' }}>
            <div><h4 style={{ marginBottom: '10px' }}>ğŸŸ¢ Tus palabras: {myWords.length}</h4><div className="words-list" style={{ justifyContent: 'flex-start' }}>{myWords.map((w, i) => <span key={i} className="word-tag">{w.word}</span>)}</div></div>
            <div><h4 style={{ marginBottom: '10px' }}>ğŸŸ£ CompaÃ±ero: {theirWords.length}</h4><div className="words-list" style={{ justifyContent: 'flex-start' }}>{theirWords.map((w, i) => <span key={i} className="word-tag">{w.word}</span>)}</div></div>
          </div>
          <div className="action-buttons"><button className="btn btn-secondary" onClick={onFinish}>Terminar</button></div>
        </div>
      );
    }

    function DialogosGame({ task, playerRole, onSubmit, onNext, history }) {
      const [message, setMessage] = useState('');
      const chatRef = useRef(null);
      useEffect(() => { if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight; }, [history]);
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const handleSend = () => { if (message.trim()) { onSubmit('dialog', message); setMessage(''); } };
      const dialogHistory = history.filter(h => h.data?.action === 'dialog');
      return (
        <div className="fade-in">
          <div className="conjugation-card" style={{ background: 'linear-gradient(135deg, #9b59b6, #bb8fce)' }}>
            <p style={{ marginBottom: '10px', opacity: '0.9' }}>Tiempo verbal: <strong>{task.tiempo}</strong></p>
            <div className="conjugation-question">{task.situacion}</div>
          </div>
          <div ref={chatRef} className="chat-messages">{dialogHistory.length === 0 && <p style={{ textAlign: 'center', color: '#999' }}>Empieza la conversaciÃ³n...</p>}{dialogHistory.map((item, i) => <div key={i} className={`chat-message ${item.data?.player}`}>{item.data?.value}</div>)}</div>
          <div style={{ marginTop: '15px', display: 'flex', gap: '10px' }}>
            <input type="text" className="input-field" placeholder={`Escribe usando ${task.tiempo}...`} value={message} onChange={(e) => setMessage(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSend()} style={{ flex: 1 }} />
            <button className="btn btn-primary" onClick={handleSend}>Enviar</button>
          </div>
          <div className="action-buttons"><button className="btn btn-secondary" onClick={() => onNext()}>â†’ Nueva situaciÃ³n</button></div>
        </div>
      );
    }

    function RoleplayGame({ task, playerRole, onNext }) {
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const myRole = playerRole === 'player1' ? task.rol1 : task.rol2;
      const theirRole = playerRole === 'player1' ? task.rol2 : task.rol1;
      return (
        <div className="fade-in">
          <div className="roleplay-card">
            <div className="roleplay-scene">ğŸ“ {task.escena}</div>
            <div className="roleplay-roles"><div className="role-badge active">ğŸ­ TÃº: <strong>{myRole}</strong></div><div className="role-badge">ğŸ­ CompaÃ±ero: <strong>{theirRole}</strong></div></div>
            <p style={{ marginTop: '20px', fontSize: '1.1rem' }}>{task.instrucciones}</p>
          </div>
          {task.vocabulario && <div style={{ background: '#f5f5f5', padding: '20px', borderRadius: '15px', marginTop: '20px' }}><h4 style={{ marginBottom: '10px' }}>ğŸ’¡ Vocabulario Ãºtil:</h4><p>{task.vocabulario.join(' â€¢ ')}</p></div>}
          <div className="action-buttons"><button className="btn btn-secondary" onClick={() => onNext()}>â†’ Nueva situaciÃ³n</button></div>
        </div>
      );
    }

    function PreguntasGame({ task, playerRole, onSubmit, onNext, history }) {
      const [answer, setAnswer] = useState('');
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const handleAnswer = () => { if (answer.trim()) { onSubmit('answer', answer); setAnswer(''); } };
      const answers = history.filter(h => h.data?.action === 'answer');
      return (
        <div className="fade-in">
          <div className="question-card"><div className="question-text">{task.pregunta}</div></div>
          {task.ayuda && <div style={{ background: '#f5f5f5', padding: '15px', borderRadius: '10px', marginTop: '20px' }}><p style={{ color: '#666', fontSize: '0.9rem' }}>ğŸ’¡ Ideas: {task.ayuda}</p></div>}
          {answers.length > 0 && <div className="chat-messages" style={{ marginTop: '20px' }}>{answers.map((item, i) => <div key={i} className={`chat-message ${item.data?.player}`}>{item.data?.value}</div>)}</div>}
          <div style={{ marginTop: '20px' }}>
            <textarea className="input-field" placeholder="Tu respuesta..." value={answer} onChange={(e) => setAnswer(e.target.value)} rows={3} />
            <div className="action-buttons"><button className="btn btn-primary" onClick={handleAnswer}>Responder</button><button className="btn btn-secondary" onClick={() => onNext()}>â†’ Siguiente</button></div>
          </div>
        </div>
      );
    }

    function CadenaGame({ wordsSubmitted, playerRole, onAddWord, onFinish }) {
      const [input, setInput] = useState('');
      const lastWord = wordsSubmitted[wordsSubmitted.length - 1];
      const lastLetter = lastWord ? lastWord.word.slice(-1).toUpperCase() : null;
      const handleAdd = (e) => { e.preventDefault(); const w = input.trim().toLowerCase(); if (!w) return; if (lastLetter && w[0].toUpperCase() !== lastLetter) { alert(`Â¡Debe empezar con "${lastLetter}"!`); return; } if (wordsSubmitted.some(x => x.word.toLowerCase() === w)) { alert('Â¡Ya se ha dicho!'); return; } onAddWord(w); setInput(''); };
      return (
        <div className="fade-in">
          <div style={{ textAlign: 'center', marginBottom: '30px' }}>
            {lastWord ? <><p>Ãšltima: <strong>{lastWord.word}</strong></p><p style={{ marginTop: '10px' }}>Siguiente con: <span style={{ fontSize: '2.5rem', fontWeight: '700', color: 'var(--primary)', marginLeft: '15px' }}>{lastLetter}</span></p></> : <p>Â¡Escribe la primera palabra!</p>}
          </div>
          <div className="word-chain">{wordsSubmitted.map((w, i) => <span key={i} className={`word ${w.player}`}>{w.word}</span>)}</div>
          <form onSubmit={handleAdd} style={{ marginTop: '30px' }}><input type="text" className="input-field" placeholder={lastLetter ? `Palabra con ${lastLetter}...` : 'Primera palabra...'} value={input} onChange={(e) => setInput(e.target.value)} autoFocus /></form>
          <div style={{ textAlign: 'center', marginTop: '20px' }}><span style={{ fontSize: '2rem', fontWeight: '700', color: 'var(--success)' }}>{wordsSubmitted.length}</span><span style={{ color: '#666' }}> palabras</span></div>
          <div className="action-buttons"><button className="btn btn-secondary" onClick={onFinish}>Terminar</button></div>
        </div>
      );
    }

    function AdivinanzaGame({ task, playerRole, isMyTurn, onScore, onNext }) {
      const [guess, setGuess] = useState('');
      if (!task) return <div style={{ textAlign: 'center', padding: '40px' }}>Cargando...</div>;
      const handleGuess = () => { if (guess.trim().toLowerCase() === task.respuesta.toLowerCase()) { alert('Â¡Correcto! ğŸ‰'); onScore(playerRole, 1); } else { alert(`Incorrecto. Era: ${task.respuesta}`); } setGuess(''); onNext(true); };
      if (isMyTurn) {
        return (
          <div className="fade-in">
            <div className="turn-indicator my-turn">ğŸ¯ Â¡Te toca describir!</div>
            <div className="tabu-card-explainer" style={{ background: 'linear-gradient(135deg, #3498db, #5dade2)' }}>
              <p style={{ marginBottom: '10px', opacity: '0.9' }}>Describe sin decir:</p>
              <div className="tabu-word">{task.respuesta}</div>
            </div>
            {task.pistas && <div style={{ background: '#f5f5f5', padding: '15px', borderRadius: '10px', marginTop: '20px' }}><p style={{ color: '#666', fontSize: '0.9rem' }}>ğŸ’¡ Pistas: {task.pistas.join(', ')}</p></div>}
            <div className="action-buttons"><button className="btn btn-secondary" onClick={() => onNext(true)}>â†’ Pasar</button></div>
          </div>
        );
      }
      return (
        <div className="fade-in">
          <div className="turn-indicator">ğŸ‘‚ Escucha y adivina</div>
          <div className="tabu-card-guesser" style={{ background: 'linear-gradient(135deg, #3498db, #5dade2)' }}><p style={{ fontSize: '1.5rem', marginBottom: '20px' }}>ğŸ¤” Â¿QuÃ© palabra es?</p></div>
          <div style={{ marginTop: '20px' }}>
            <input type="text" className="input-field" placeholder="Tu respuesta..." value={guess} onChange={(e) => setGuess(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleGuess()} />
            <div className="action-buttons"><button className="btn btn-primary" onClick={handleGuess}>Â¡Adivinar!</button></div>
          </div>
        </div>
      );
    }

    function BatallaGame({ playerRole, history, onSubmit, onScore, onFinish }) {
      const [verb, setVerb] = useState('');
      const [conj, setConj] = useState('');
      const handleSubmit = (e) => { e.preventDefault(); if (verb.trim() && conj.trim()) { onSubmit('verb', { verb: verb.trim(), conjugation: conj.trim() }); onScore(playerRole, 1); setVerb(''); setConj(''); } };
      const myVerbs = history.filter(h => h.data?.action === 'verb' && h.data?.player === playerRole);
      const theirVerbs = history.filter(h => h.data?.action === 'verb' && h.data?.player !== playerRole);
      return (
        <div className="fade-in">
          <p style={{ textAlign: 'center', color: '#666', marginBottom: '20px' }}>Â¡Conjuga tantos verbos como puedas!</p>
          <div className="battle-arena">
            <div className="battle-player"><h4>ğŸŸ¢ TÃº: {myVerbs.length}</h4><div className="battle-words">{myVerbs.map((v, i) => <div key={i}>{v.data?.value?.verb} â†’ {v.data?.value?.conjugation}</div>)}</div></div>
            <div className="battle-player player-two"><h4>ğŸŸ£ CompaÃ±ero: {theirVerbs.length}</h4><div className="battle-words">{theirVerbs.map((v, i) => <div key={i}>{v.data?.value?.verb} â†’ {v.data?.value?.conjugation}</div>)}</div></div>
          </div>
          <form onSubmit={handleSubmit} style={{ marginTop: '20px' }}>
            <div style={{ display: 'flex', gap: '10px' }}>
              <input type="text" className="input-field" placeholder="Verbo" value={verb} onChange={(e) => setVerb(e.target.value)} style={{ flex: 1 }} />
              <input type="text" className="input-field" placeholder="Yo..." value={conj} onChange={(e) => setConj(e.target.value)} style={{ flex: 1 }} />
              <button type="submit" className="btn btn-success">+</button>
            </div>
          </form>
          <div className="action-buttons"><button className="btn btn-secondary" onClick={onFinish}>Terminar</button></div>
        </div>
      );
    }

    function ResultsScreen({ scores, onPlayAgain, onExit }) {
      const winner = scores.player1 > scores.player2 ? 'player1' : scores.player2 > scores.player1 ? 'player2' : 'tie';
      return (
        <div className="app-container">
          <div className="game-screen fade-in" style={{ textAlign: 'center' }}>
            <h1 style={{ fontSize: '3rem', marginBottom: '20px' }}>{winner === 'tie' ? 'ğŸ¤ Â¡Empate!' : 'ğŸ‰ Â¡Fin del juego!'}</h1>
            <div className="scoreboard" style={{ marginBottom: '30px' }}>
              <div className="score-card" style={{ transform: winner === 'player1' ? 'scale(1.1)' : 'scale(1)', border: winner === 'player1' ? '3px solid gold' : 'none' }}><div className="label">ğŸŸ¢ Jugador 1</div><div className="points">{scores.player1 || 0}</div></div>
              <div className="score-card player2" style={{ transform: winner === 'player2' ? 'scale(1.1)' : 'scale(1)', border: winner === 'player2' ? '3px solid gold' : 'none' }}><div className="label">ğŸŸ£ Jugador 2</div><div className="points">{scores.player2 || 0}</div></div>
            </div>
            <div className="action-buttons"><button className="btn btn-primary" onClick={onPlayAgain}>ğŸ® Jugar otro</button><button className="btn btn-outline" onClick={onExit}>ğŸšª Salir</button></div>
          </div>
        </div>
      );
    }

    function AdminLogin({ socket, onBack }) {
      const [password, setPassword] = useState('');
      const handleLogin = () => socket.emit('admin_login', password);
      return (
        <div className="app-container">
          <div className="game-screen fade-in" style={{ maxWidth: '400px' }}>
            <button className="back-btn" onClick={onBack}>â† Volver</button>
            <div style={{ textAlign: 'center', marginTop: '40px' }}>
              <h2>ğŸ‘¨â€ğŸ« Panel de Administrador</h2>
              <div style={{ marginTop: '30px' }}><input type="password" className="input-field" placeholder="ContraseÃ±a" value={password} onChange={(e) => setPassword(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} /></div>
              <div style={{ marginTop: '20px' }}><button className="btn btn-primary" onClick={handleLogin}>Entrar</button></div>
            </div>
          </div>
        </div>
      );
    }

    function AdminPanel({ socket, onLogout }) {
      const [activeTab, setActiveTab] = useState('games');
      const [activeGames, setActiveGames] = useState([]);
      const [tasks, setTasks] = useState({});
      const [selectedCollection, setSelectedCollection] = useState('tabu');
      const [showAddModal, setShowAddModal] = useState(false);
      useEffect(() => {
        socket.emit('get_active_games');
        socket.on('active_games_list', (g) => setActiveGames(g));
        socket.on('tasks_list', (t) => setTasks(prev => ({ ...prev, [selectedCollection]: t })));
        socket.on('task_added', (t) => setTasks(prev => ({ ...prev, [selectedCollection]: [...(prev[selectedCollection] || []), t] })));
        socket.on('task_deleted', ({ id }) => setTasks(prev => ({ ...prev, [selectedCollection]: (prev[selectedCollection] || []).filter(t => t.id !== id) })));
        const interval = setInterval(() => socket.emit('get_active_games'), 5000);
        return () => { clearInterval(interval); socket.off('active_games_list'); socket.off('tasks_list'); socket.off('task_added'); socket.off('task_deleted'); };
      }, [selectedCollection]);
      const loadTasks = (c) => { setSelectedCollection(c); socket.emit('get_tasks', c); };
      const deleteTask = (id) => { if (confirm('Â¿Eliminar?')) socket.emit('delete_task', selectedCollection, id); };
      return (
        <div className="admin-panel">
          <div className="admin-header"><h1>ğŸ‘¨â€ğŸ« Panel de Administrador</h1><button className="btn btn-outline" style={{ color: 'white', borderColor: 'white', marginTop: '10px' }} onClick={onLogout}>Cerrar sesiÃ³n</button></div>
          <div className="admin-tabs"><button className={`admin-tab ${activeTab === 'games' ? 'active' : ''}`} onClick={() => setActiveTab('games')}>ğŸ® Partidas</button><button className={`admin-tab ${activeTab === 'tasks' ? 'active' : ''}`} onClick={() => { setActiveTab('tasks'); loadTasks('tabu'); }}>ğŸ“ Tareas</button></div>
          {activeTab === 'games' && <div className="admin-card"><h3>Partidas ({activeGames.length})</h3>{activeGames.length === 0 ? <p style={{ opacity: 0.7 }}>No hay partidas activas</p> : activeGames.map(g => <div key={g.id} className="task-item"><div className="task-content"><div className="task-word">{g.roomCode} - {g.currentGame || 'Eligiendo'}</div><div className="task-prohibited">Jugadores: {g.playerCount}/2 | Puntos: {g.scores?.player1 || 0} vs {g.scores?.player2 || 0}</div></div></div>)}</div>}
          {activeTab === 'tasks' && <>
            <div className="admin-tabs">{['tabu', 'conjugacion', 'palabrasPorTema', 'dialogos', 'roleplay', 'preguntas', 'adivinanza'].map(c => <button key={c} className={`admin-tab ${selectedCollection === c ? 'active' : ''}`} onClick={() => loadTasks(c)}>{c}</button>)}</div>
            <div className="admin-card">
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}><h3>Tareas: {selectedCollection}</h3><button className="btn btn-success" onClick={() => setShowAddModal(true)}>+ AÃ±adir</button></div>
              <div className="task-list">{(tasks[selectedCollection] || []).map(t => <div key={t.id} className="task-item"><div className="task-content"><div className="task-word">{t.palabra || t.pregunta || t.tema || t.escena || t.respuesta || t.verbo}</div><div className="task-prohibited">{t.prohibidas?.join(', ') || t.respuesta || t.tiempo || t.situacion || ''}</div></div><button className="delete-btn" onClick={() => deleteTask(t.id)}>ğŸ—‘ï¸</button></div>)}</div>
            </div>
          </>}
          {showAddModal && <AddTaskModal collection={selectedCollection} onClose={() => setShowAddModal(false)} socket={socket} />}
        </div>
      );
    }

    function AddTaskModal({ collection, onClose, socket }) {
      const [formData, setFormData] = useState({});
      const handleSubmit = (e) => { e.preventDefault(); socket.emit('add_task', collection, { ...formData, nivel: 'A2' }); onClose(); };
      const fields = {
        tabu: <><div className="form-group"><label>Palabra</label><input type="text" value={formData.palabra || ''} onChange={(e) => setFormData({...formData, palabra: e.target.value})} required /></div><div className="form-group"><label>Prohibidas (coma)</label><input type="text" value={formData.prohibidasText || ''} onChange={(e) => setFormData({...formData, prohibidasText: e.target.value, prohibidas: e.target.value.split(',').map(w => w.trim())})} required /></div></>,
        conjugacion: <><div className="form-group"><label>Verbo</label><input type="text" value={formData.verbo || ''} onChange={(e) => setFormData({...formData, verbo: e.target.value})} required /></div><div className="form-group"><label>Pregunta</label><input type="text" value={formData.pregunta || ''} onChange={(e) => setFormData({...formData, pregunta: e.target.value})} required /></div><div className="form-group"><label>Respuesta</label><input type="text" value={formData.respuesta || ''} onChange={(e) => setFormData({...formData, respuesta: e.target.value})} required /></div></>,
        palabrasPorTema: <div className="form-group"><label>Tema</label><input type="text" value={formData.tema || ''} onChange={(e) => setFormData({...formData, tema: e.target.value})} required /></div>,
        dialogos: <><div className="form-group"><label>Tiempo</label><select value={formData.tiempo || 'presente'} onChange={(e) => setFormData({...formData, tiempo: e.target.value})}><option value="presente">Presente</option><option value="pasado">Pasado</option><option value="imperfecto">Imperfecto</option><option value="futuro">Futuro</option><option value="subjuntivo">Subjuntivo</option></select></div><div className="form-group"><label>SituaciÃ³n</label><textarea value={formData.situacion || ''} onChange={(e) => setFormData({...formData, situacion: e.target.value})} required rows={3} /></div></>,
        roleplay: <><div className="form-group"><label>Escena</label><input type="text" value={formData.escena || ''} onChange={(e) => setFormData({...formData, escena: e.target.value})} required /></div><div className="form-group"><label>Rol 1</label><input type="text" value={formData.rol1 || ''} onChange={(e) => setFormData({...formData, rol1: e.target.value})} required /></div><div className="form-group"><label>Rol 2</label><input type="text" value={formData.rol2 || ''} onChange={(e) => setFormData({...formData, rol2: e.target.value})} required /></div><div className="form-group"><label>Instrucciones</label><textarea value={formData.instrucciones || ''} onChange={(e) => setFormData({...formData, instrucciones: e.target.value})} required rows={3} /></div><div className="form-group"><label>Vocabulario (coma)</label><input type="text" value={formData.vocabularioText || ''} onChange={(e) => setFormData({...formData, vocabularioText: e.target.value, vocabulario: e.target.value.split(',').map(w => w.trim())})} /></div></>,
        preguntas: <><div className="form-group"><label>Pregunta</label><textarea value={formData.pregunta || ''} onChange={(e) => setFormData({...formData, pregunta: e.target.value})} required rows={2} /></div><div className="form-group"><label>Ayuda</label><input type="text" value={formData.ayuda || ''} onChange={(e) => setFormData({...formData, ayuda: e.target.value})} /></div></>,
        adivinanza: <><div className="form-group"><label>Palabra</label><input type="text" value={formData.respuesta || ''} onChange={(e) => setFormData({...formData, respuesta: e.target.value})} required /></div><div className="form-group"><label>Pistas (coma)</label><input type="text" value={formData.pistasText || ''} onChange={(e) => setFormData({...formData, pistasText: e.target.value, pistas: e.target.value.split(',').map(w => w.trim())})} /></div></>
      };
      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <h2>AÃ±adir: {collection}</h2>
            <form onSubmit={handleSubmit}>{fields[collection]}<div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}><button type="submit" className="btn btn-success">Guardar</button><button type="button" className="btn btn-outline" onClick={onClose}>Cancelar</button></div></form>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
